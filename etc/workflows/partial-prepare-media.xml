<?xml version="1.0" encoding="UTF-8"?>
<definition xmlns="http://workflow.opencastproject.org">

  <id>partial-prepare-media</id>
  <title>Prepare source media for further processing</title>
  <tags/>
  <description/>
  <configuration_panel/>
  <operations>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <!-- Prepare the source media for further processing                   -->
    <!--                                                                   -->
    <!-- Ensure the media is in a format that allows Opencast to do        -->
    <!-- its work. This includes potentially rewriting the container and   -->
    <!-- making sure that the audio track is part of each video track.     -->
    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

    <!-- TODO test processing without prepate-av -->
    <!-- Prepare presenter track -->

    <!--operation
      id="prepare-av"
      exception-handler-workflow="partial-error"
      description="Preparing presenter (camera) audio and video work versions">
      <configurations>
        <configuration key="source-flavor">presenter/source</configuration>
        <configuration key="target-flavor">presenter/prepared</configuration>
        <configuration key="rewrite">false</configuration>
        <configuration key="audio-muxing-source-flavors">*/?,*/*</configuration>
      </configurations>
    </operation-->

    <!-- Prepare presentation track -->

    <!--operation
      id="prepare-av"
      exception-handler-workflow="partial-error"
      description="Preparing presentation (screen) audio and video work version">
      <configurations>
        <configuration key="source-flavor">presentation/source</configuration>
        <configuration key="target-flavor">presentation/prepared</configuration>
        <configuration key="rewrite">false</configuration>
        <configuration key="audio-muxing-source-flavors">*/?,*/*</configuration>
      </configurations>
    </operation-->

    <!-- TODO remove tag operations if prepare-av will be run before -->
    <operation
      id="tag"
      exception-handler-workflow="partial-error"
      description="Tag presenter source media as prepared">
      <configurations>
        <configuration key="source-flavors">presenter/source</configuration>
        <configuration key="target-flavor">presenter/prepared</configuration>
        <configuration key="target-tags">-archive</configuration>
        <configuration key="copy">true</configuration>
      </configurations>
    </operation>

    <operation
      id="tag"
      exception-handler-workflow="partial-error"
      description="Tag presentation source media as prepared">
      <configurations>
        <configuration key="source-flavors">presentation/source</configuration>
        <configuration key="target-flavor">presentation/prepared</configuration>
        <configuration key="target-tags">-archive</configuration>
        <configuration key="copy">true</configuration>
      </configurations>
    </operation>

    <!-- Analyze media assets -->

    <operation
      id="analyze-tracks"
      exception-handler-workflow="partial-error"
      description="Analyze tracks in media package and set control variables">
      <configurations>
        <configuration key="source-flavor">*/prepared</configuration>
      </configurations>
    </operation>

  </operations>
</definition>
