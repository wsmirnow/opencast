<?xml version="1.0" encoding="UTF-8" ?>
<definition xmlns="http://workflow.opencastproject.org">

  <id>schedule-and-upload</id>
  <title>Process upon upload and schedule</title>
  <tags>
    <tag>upload</tag>
    <tag>schedule</tag>
  </tags>
  <displayOrder>1000</displayOrder>
  <description>
    A default workflow for processing media.
  </description>
  <configuration_panel>
    <![CDATA[
      <div id="workflow-configuration">
        <fieldset>
          <input id="autoPublish" name="autoPublish" type="checkbox" class="configField" value="false" />
          <label for="autoPublish">Auto publish</label>
        </fieldset>
        <!-- Hidden options -->
        <!-- This options should not be visible to the user for a better user experience. -->
        <!-- In most cases these properties are fix for your system.                      -->
        <fieldset>
          <input id="publishToEngage" name="publishToEngage" type="hidden" value="true" />
          <input id="publishToApi" name="publishToApi" type="hidden" value="false" />
          <input id="publishToOaiPmh" name="publishToOaiPmh" type="hidden" value="false" />
          <input id="publishToAws" name="publishToAws" type="hidden" value="false" />
          <input id="publishToYouTube" name="publishToYouTube" type="hidden" value="false" />
        </fieldset>
      </div>
    ]]>
  </configuration_panel>
  <operations>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <!-- Apply default workflow properties                                 -->
    <!--                                                                   -->
    <!-- The worklfow properties are simplified for a better               -->
    <!-- user experience, please preconfigure your defaults here.          -->
    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

    <operation
      id="defaults"
      description="Applying default configuration values">
      <configurations>
        <configuration key="autoPublish">false</configuration>
        <configuration key="publishToEngage">true</configuration>
        <configuration key="publishToApi">false</configuration>
        <configuration key="publishToOaiPmh">false</configuration>
        <configuration key="publishToAws">false</configuration>
        <configuration key="publishToYouTube">false</configuration>
      </configurations>
    </operation>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <!-- Prepare asset                                                     -->
    <!--                                                                   -->
    <!-- Prepare the recording for asset management, including creation of -->
    <!-- previews, audio waveforms and storing of the recording data in    -->
    <!-- the asset area for further processing.                            -->
    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

    <!-- Make sure all elements are downloaded from external sources and   -->
    <!-- inside of Opencast                                                -->

    <operation
      id="include"
      description="Finalize upload and ingest">
      <configurations>
        <configuration key="workflow-id">partial-ingest</configuration>
      </configurations>
    </operation>

    <!-- Archive the source material -->

    <operation
      id="snapshot"
      description="Archive raw recording after ingest">
      <configurations>
        <configuration key="source-tags">archive</configuration>
      </configurations>
    </operation>

    <!-- Create preview artifacts -->

    <operation
      id="include"
      description="Prepare preview versions of the recording">
      <configurations>
        <configuration key="workflow-id">partial-preview</configuration>
      </configurations>
    </operation>

    <!-- Archive generated preview assets -->

    <operation
      id="snapshot"
      description="Archive preview information">
      <configurations>
        <configuration key="source-tags">archive</configuration>
      </configurations>
    </operation>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <!-- Tag for review and cutting                                        -->
    <!--                                                                   -->
    <!-- Add comments in order to mark the recording for preview and/or    -->
    <!-- cutting.                                                          -->
    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

    <!-- Mark the recording for cutting -->

    <operation
      id="comment"
      if="NOT ${autoPublish}"
      description="Mark the recording for cutting">
      <configurations>
        <configuration key="description">Recording has not been cut yet.</configuration>
        <configuration key="reason">EVENTS.EVENTS.DETAILS.COMMENTS.REASONS.CUTTING</configuration>
        <configuration key="action">create</configuration>
      </configurations>
    </operation>

    <!-- Mark the recording for review -->

    <operation
      id="comment"
      description="Mark the recording for review">
      <configurations>
        <configuration key="description">Recording has not been reviewed yet.</configuration>
        <configuration key="reason">EVENTS.EVENTS.DETAILS.COMMENTS.REASONS.REVIEW</configuration>
        <configuration key="action">create</configuration>
      </configurations>
    </operation>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <!-- Publish                                                           -->
    <!--                                                                   -->
    <!-- Encode and publish the recording to the predefined                -->
    <!-- publication channels.                                             -->
    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

    <operation
      id="include"
      if="${autoPublish}"
      description="Publish the recording">
      <configurations>
        <configuration key="workflow-id">partial-publish</configuration>
      </configurations>
    </operation>

    <!-- Archive the recording -->

    <operation
      id="snapshot"
      if="${autoPublish}"
      description="Archive publishing information">
      <configurations>
        <configuration key="source-tags">archive</configuration>
      </configurations>
    </operation>

    <!-- Clean up work artifacts -->

    <operation
      id="cleanup"
      fail-on-error="false"
      description="Remove temporary processing artifacts">
      <configurations>
        <!-- On systems without shared workspace or working file repository -->
        <!-- you want to set this option to true. -->
        <configuration key="delete-external">false</configuration>
        <!-- FixMe Don't clean up ACLs until workflow service no longer looks for them in the WFR. -->
        <!-- TODO test if this issue is fixed -->
        <!-- <configuration key="preserve-flavors">security/*</configuration> -->
      </configurations>
    </operation>

  </operations>
</definition>
